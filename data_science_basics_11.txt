   1: import numpy as np
   2: import pandas as pd
   3: rng = np.random.default_rng()
   4: a = rng.standard_normal((100_000, 10))
   5: a.nbytes
8000000
   6: import sys
   7: sys.getsizeof(a)
8000128
   8: index = pd.date_range('2025-1-20', periods=a.shape[0], freq='1min')
   9: index
DatetimeIndex(['2025-01-20 00:00:00', '2025-01-20 00:01:00',
               '2025-01-20 00:02:00', '2025-01-20 00:03:00',
               '2025-01-20 00:04:00', '2025-01-20 00:05:00',
               '2025-01-20 00:06:00', '2025-01-20 00:07:00',
               '2025-01-20 00:08:00', '2025-01-20 00:09:00',
               ...
               '2025-03-30 10:30:00', '2025-03-30 10:31:00',
               '2025-03-30 10:32:00', '2025-03-30 10:33:00',
               '2025-03-30 10:34:00', '2025-03-30 10:35:00',
               '2025-03-30 10:36:00', '2025-03-30 10:37:00',
               '2025-03-30 10:38:00', '2025-03-30 10:39:00'],
              dtype='datetime64[ns]', length=100000, freq='min')
  10: c = 'ABCDEFGHIJ'
  11: df = pd.DataFrame(a, index=index, columns=list(c))
  12: df.head()
                            A         B         C         D         E         F         G         H         I         J
2025-01-20 00:00:00  1.291245  0.724515  0.352665  0.809501 -1.245412  2.005216 -0.808978  0.506869 -0.094638  0.340397
2025-01-20 00:01:00  1.927302  0.656655 -2.575690 -2.307561  1.731951  0.573647  0.136809  1.552682 -0.728623 -0.980200
2025-01-20 00:02:00  0.602937 -0.386649 -0.926697  0.579893 -1.559066 -0.511112  1.152119 -0.575647  0.486163  1.343432
2025-01-20 00:03:00  0.473023 -0.866857  0.562502  1.144134  2.203601  0.879538  0.051295  0.067494  1.236718 -0.806272
2025-01-20 00:04:00 -1.715635  0.573682 -0.108654  1.771967 -0.142852  0.681099 -1.269759 -0.704051  0.086960 -0.436956
  13: %time df.to_csv('data.csv')
  14: ls -n
  15: %time df.to_hdf('data.hd5', key='data')
  16: ls -n
  17: %time df.to_parquet('data.pq')
  18: %time df.to_excel('data.xlsx')
  19: ls -n
  20:
%%time
for _ in range(10):
    !rm data.csv
    df.to_csv('data.csv')
  21: ls -n
  22:
%%time
for _ in range(10):
    !rm data.hd5
    df.to_hdf('data.hd5', key='data')
  23:
%%time
for _ in range(10):
    !rm data.pq
    df.to_parquet('data.pq')
  24: import sqlite3 as sq3
  25: con = sq3.connect('data.sq3')
  26: %time df.to_sql('data', con)
100000
  27: ls -n
  28: con.execute('SELECT * FROM data').fetchmany(5)
[('2025-01-20 00:00:00',
  1.2912454557806388,
  0.7245148127868732,
  0.35266511638294373,
  0.8095010810343278,
  -1.2454116858452557,
  2.005216070353096,
  -0.8089781107421321,
  0.5068690308930275,
  -0.09463763382106391,
  0.34039725333755644),
 ('2025-01-20 00:01:00',
  1.9273021014048457,
  0.6566546877829454,
  -2.5756902488521702,
  -2.3075613058943647,
  1.7319511612077478,
  0.5736471072014662,
  0.13680894455118148,
  1.5526818129986972,
  -0.7286227611419379,
  -0.9802003598661475),
 ('2025-01-20 00:02:00',
  0.6029372854342308,
  -0.38664934323413325,
  -0.9266970759466652,
  0.5798929889104113,
  -1.5590658326045377,
  -0.5111118943543187,
  1.1521190909047474,
  -0.5756470011586501,
  0.4861631293349024,
  1.3434319374547214),
 ('2025-01-20 00:03:00',
  0.4730226095913912,
  -0.8668565085649177,
  0.5625021774065364,
  1.1441335479975956,
  2.2036005221928927,
  0.879537533406946,
  0.05129518794069222,
  0.06749418541725707,
  1.236718423505635,
  -0.8062716638977347),
 ('2025-01-20 00:04:00',
  -1.7156345586115314,
  0.5736818442801935,
  -0.1086539085159937,
  1.7719666407075132,
  -0.14285222635453337,
  0.6810986919821589,
  -1.2697586759866923,
  -0.7040506538398406,
  0.08696035678829568,
  -0.43695588767565013)]
  29: con.execute('SELECT * FROM sqlite_master').fetchall()
[('table',
  'data',
  'data',
  2,
  'CREATE TABLE "data" (\n"index" TIMESTAMP,\n  "A" REAL,\n  "B" REAL,\n  "C" REAL,\n  "D" REAL,\n  "E" REAL,\n  "F" REAL,\n  "G" REAL,\n  "H" REAL,\n  "I" REAL,\n  "J" REAL\n)'),
 ('index',
  'ix_data_index',
  'data',
  3,
  'CREATE INDEX "ix_data_index"ON "data" ("index")')]
  30: %time df_ = df.read_csv('data.csv')
  31: %time df_ = pd.read_csv('data.csv')
  32: df_.head()
            Unnamed: 0         A         B         C         D         E         F         G         H         I         J
0  2025-01-20 00:00:00  1.291245  0.724515  0.352665  0.809501 -1.245412  2.005216 -0.808978  0.506869 -0.094638  0.340397
1  2025-01-20 00:01:00  1.927302  0.656655 -2.575690 -2.307561  1.731951  0.573647  0.136809  1.552682 -0.728623 -0.980200
2  2025-01-20 00:02:00  0.602937 -0.386649 -0.926697  0.579893 -1.559066 -0.511112  1.152119 -0.575647  0.486163  1.343432
3  2025-01-20 00:03:00  0.473023 -0.866857  0.562502  1.144134  2.203601  0.879538  0.051295  0.067494  1.236718 -0.806272
4  2025-01-20 00:04:00 -1.715635  0.573682 -0.108654  1.771967 -0.142852  0.681099 -1.269759 -0.704051  0.086960 -0.436956
  33: %time df_ = pd.read_csv('data.csv', index_col=0, parse_dates=True)
  34: df_.head()
                            A         B         C         D         E         F         G         H         I         J
2025-01-20 00:00:00  1.291245  0.724515  0.352665  0.809501 -1.245412  2.005216 -0.808978  0.506869 -0.094638  0.340397
2025-01-20 00:01:00  1.927302  0.656655 -2.575690 -2.307561  1.731951  0.573647  0.136809  1.552682 -0.728623 -0.980200
2025-01-20 00:02:00  0.602937 -0.386649 -0.926697  0.579893 -1.559066 -0.511112  1.152119 -0.575647  0.486163  1.343432
2025-01-20 00:03:00  0.473023 -0.866857  0.562502  1.144134  2.203601  0.879538  0.051295  0.067494  1.236718 -0.806272
2025-01-20 00:04:00 -1.715635  0.573682 -0.108654  1.771967 -0.142852  0.681099 -1.269759 -0.704051  0.086960 -0.436956
  35: %time df_ = pd.read_hdf('data.hd5', 'data')
  36: df_.head()
                            A         B         C         D         E         F         G         H         I         J
2025-01-20 00:00:00  1.291245  0.724515  0.352665  0.809501 -1.245412  2.005216 -0.808978  0.506869 -0.094638  0.340397
2025-01-20 00:01:00  1.927302  0.656655 -2.575690 -2.307561  1.731951  0.573647  0.136809  1.552682 -0.728623 -0.980200
2025-01-20 00:02:00  0.602937 -0.386649 -0.926697  0.579893 -1.559066 -0.511112  1.152119 -0.575647  0.486163  1.343432
2025-01-20 00:03:00  0.473023 -0.866857  0.562502  1.144134  2.203601  0.879538  0.051295  0.067494  1.236718 -0.806272
2025-01-20 00:04:00 -1.715635  0.573682 -0.108654  1.771967 -0.142852  0.681099 -1.269759 -0.704051  0.086960 -0.436956
  37: %time df_ = pd.read_parquet('data.pq')
  38: df_.head()
                            A         B         C         D         E         F         G         H         I         J
2025-01-20 00:00:00  1.291245  0.724515  0.352665  0.809501 -1.245412  2.005216 -0.808978  0.506869 -0.094638  0.340397
2025-01-20 00:01:00  1.927302  0.656655 -2.575690 -2.307561  1.731951  0.573647  0.136809  1.552682 -0.728623 -0.980200
2025-01-20 00:02:00  0.602937 -0.386649 -0.926697  0.579893 -1.559066 -0.511112  1.152119 -0.575647  0.486163  1.343432
2025-01-20 00:03:00  0.473023 -0.866857  0.562502  1.144134  2.203601  0.879538  0.051295  0.067494  1.236718 -0.806272
2025-01-20 00:04:00 -1.715635  0.573682 -0.108654  1.771967 -0.142852  0.681099 -1.269759 -0.704051  0.086960 -0.436956
  39: %time df_ = pd.read_excel('data.xlsx')
  40: df_.head()
           Unnamed: 0         A         B         C         D         E         F         G         H         I         J
0 2025-01-20 00:00:00  1.291245  0.724515  0.352665  0.809501 -1.245412  2.005216 -0.808978  0.506869 -0.094638  0.340397
1 2025-01-20 00:01:00  1.927302  0.656655 -2.575690 -2.307561  1.731951  0.573647  0.136809  1.552682 -0.728623 -0.980200
2 2025-01-20 00:02:00  0.602937 -0.386649 -0.926697  0.579893 -1.559066 -0.511112  1.152119 -0.575647  0.486163  1.343432
3 2025-01-20 00:03:00  0.473023 -0.866857  0.562502  1.144134  2.203601  0.879538  0.051295  0.067494  1.236718 -0.806272
4 2025-01-20 00:04:00 -1.715635  0.573682 -0.108654  1.771967 -0.142852  0.681099 -1.269759 -0.704051  0.086960 -0.436956
  41: %time df_ = pd.read_sql('SELECT * FROM data', con)
  42: df_.head()
                 index         A         B         C         D         E         F         G         H         I         J
0  2025-01-20 00:00:00  1.291245  0.724515  0.352665  0.809501 -1.245412  2.005216 -0.808978  0.506869 -0.094638  0.340397
1  2025-01-20 00:01:00  1.927302  0.656655 -2.575690 -2.307561  1.731951  0.573647  0.136809  1.552682 -0.728623 -0.980200
2  2025-01-20 00:02:00  0.602937 -0.386649 -0.926697  0.579893 -1.559066 -0.511112  1.152119 -0.575647  0.486163  1.343432
3  2025-01-20 00:03:00  0.473023 -0.866857  0.562502  1.144134  2.203601  0.879538  0.051295  0.067494  1.236718 -0.806272
4  2025-01-20 00:04:00 -1.715635  0.573682 -0.108654  1.771967 -0.142852  0.681099 -1.269759 -0.704051  0.086960 -0.436956
  43: %timeit df_ = pd.read_csv('data.csv', index_col=0, parse_dates=True)
  44: %timeit df_ = pd.read_hdf('data.hd5', 'data')
  45: %timeit df_ = pd.read_parquet('data.pq')
  46: %time pd.read_csv('data.csv', index_col=0, parse_dates=True)['H'].mean()
np.float64(0.0027223885235006526)
  47: %timeit pd.read_csv('data.csv', index_col=0, parse_dates=True)['H'].mean()
  48: %time pd.read_hdf('data.hd5')['H'].mean()
np.float64(0.002722388523500653)
  49: %timeit pd.read_hdf('data.hd5')['H'].mean()
  50: %timeit pd.read_parquet('data.pq')['H'].mean()
  51: con.execute('SELECT AVG(H) FROM data').fetchall()
[(0.002722388523500652,)]
  52: %time con.execute('SELECT AVG(H) FROM data').fetchall()
[(0.002722388523500652,)]
  53: %timeit con.execute('SELECT AVG(H) FROM data').fetchall()
  54: %time con.execute('SELECT AVG(H) FROM data WHERE A > 1.5').fetchall()
[(-0.006017353013785305,)]
  55:
%%time
r = pd.read_hdf('data.hd5')
r[r['A'] > 1.5]['H'].mean()
np.float64(-0.006017353013785307)
  56: rm data.*
  57: cd live
  58: %history -n -o -f data_science_basics_11.txt
